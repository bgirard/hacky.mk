#!/bin/bash

set -e

# Allow passing a dir to work in as the first arg
if [ $# -gt 0 ] ; then
  cd "$1"
fi

if [ ! -f config/autoconf.mk ]; then
    echo "Can't find config/autoconf.mk, is this a configured and built build directory?"
    exit 1
fi

topsrcdir=`grep '^top_srcdir' config/autoconf.mk | sed 's,^top_srcdir *= *,,g'`
baseninja=$topsrcdir/tools/hackymake/hacky.ninja

if [ ! -f $baseninja ]; then
    echo "Can't find $baseninja"
    exit 1
fi

cp $baseninja build.ninja

echo "# AUTOMATICALLY GENERATED BY reninja ON" `date` > build.ninja
cat $baseninja >> build.ninja
for file in .hacky/*.ninja; do cat "$file" >> build.ninja; done

echo Created build.ninja in `pwd`

